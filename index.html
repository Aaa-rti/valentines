<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Yohooo Big Summer Blowout</title>

  <style>
    :root {
      /* Blue background + yellow popup theme */
      --bg1: #031628;
      --bg2: #062a4a;
      --bg3: #0b3a66;

      --card: rgba(255, 230, 120, 0.92);   /* yellow popup */
      --panel: rgba(255, 230, 120, 0.88);
      --border: rgba(0,0,0,0.12);

      --text: #0b1b2a;     /* dark text on yellow */
      --muted: rgba(11, 27, 42, 0.75);

      --accent: #0b3a66;   /* blue accent */
      --accent2: #123d5a;
      --danger: #b00020;

      --shadow: 0 18px 60px rgba(0,0,0,0.40);
      --radius: 18px;
    }

    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color: var(--text);
      background:
        radial-gradient(1200px 700px at 15% 15%, rgba(90, 190, 255, 0.16), transparent 60%),
        radial-gradient(1200px 700px at 85% 25%, rgba(0, 120, 255, 0.14), transparent 58%),
        radial-gradient(900px 700px at 40% 90%, rgba(0, 255, 200, 0.10), transparent 60%),
        linear-gradient(135deg, var(--bg1), var(--bg2), var(--bg3));
      min-height: 100vh;
      display: grid;
      place-items: center;
      padding: 26px;
    }

    .wrap {
      width: min(980px, 100%);
    }

    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
    }

    header {
      padding: 22px 22px 14px;
      border-bottom: 1px solid rgba(0,0,0,0.10);
      text-align: center;
      transition: opacity 260ms ease, transform 260ms ease;
    }

    header.fading {
      opacity: 0;
      transform: translateY(-6px);
      pointer-events: none;
    }

    h1 {
      margin: 0 0 8px 0;
      font-size: clamp(22px, 3vw, 34px);
      letter-spacing: 0.2px;
      font-weight: 900;
    }

    .subtitle {
      margin: 0 auto;
      max-width: 62ch;
      color: var(--muted);
      line-height: 1.45;
      font-size: 15px;
    }

    /* ‚ÄúGamey‚Äù progress dots */
    .progress {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-top: 12px;
    }
    .dot {
      width: 9px;
      height: 9px;
      border-radius: 999px;
      background: rgba(11, 27, 42, 0.25);
      border: 1px solid rgba(11, 27, 42, 0.15);
      transition: transform 160ms ease, background 160ms ease;
    }
    .dot.active {
      background: rgba(11, 58, 102, 0.85);
      transform: scale(1.15);
    }
    .dot.done {
      background: rgba(11, 58, 102, 0.55);
    }

    .content {
      padding: 22px;
    }

    .screen {
      display: none;
      width: 100%;
    }
    .screen.active {
      display: block;
    }

    /* This is the key fix: hard-center the panel with equal gutters */
    .panel {
      width: min(760px, 100%);
      margin: 0 auto;               /* <‚Äî centers it */
      background: var(--panel);
      border: 1px solid rgba(0,0,0,0.10);
      border-radius: 16px;
      padding: 18px;
      text-align: center;

      transition: opacity 260ms ease, transform 260ms ease;
      box-shadow: 0 10px 30px rgba(0,0,0,0.18);
    }

    .panel.fading {
      opacity: 0;
      transform: translateY(10px);
      pointer-events: none;
    }

    .hint {
      color: var(--muted);
      font-size: 14px;
      line-height: 1.45;
      margin: 0 auto;
      max-width: 62ch;
    }

    .btns {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin-top: 14px;
    }

    button {
      appearance: none;
      border: 1px solid rgba(11, 27, 42, 0.22);
      background: rgba(255,255,255,0.35);
      color: var(--text);
      padding: 10px 14px;
      border-radius: 12px;
      font-weight: 750;
      cursor: pointer;
      transition: transform 0.08s ease, background 0.2s ease;
      user-select: none;
      min-width: 170px;
    }
    button:hover { transform: translateY(-1px); background: rgba(255,255,255,0.50); }
    button:active { transform: translateY(0px) scale(0.99); }

    .primary {
      border-color: rgba(11, 58, 102, 0.55);
      background: rgba(11, 58, 102, 0.18);
    }
    .primary:hover { background: rgba(11, 58, 102, 0.25); }

    .good {
      border-color: rgba(0, 120, 120, 0.55);
      background: rgba(0, 120, 120, 0.18);
    }
    .good:hover { background: rgba(0, 120, 120, 0.25); }

    .danger {
      border-color: rgba(176, 0, 32, 0.55);
      background: rgba(176, 0, 32, 0.16);
    }
    .danger:hover { background: rgba(176, 0, 32, 0.22); }

    .status {
      font-weight: 800;
      margin-top: 12px;
      min-height: 1.2em;
    }
    .status.ok { color: #0b6b52; }
    .status.no { color: var(--danger); }

    img.photo {
      width: 100%;
      height: 340px;
      object-fit: cover;
      border-radius: 14px;
      border: 1px solid rgba(0,0,0,0.12);
      background: rgba(0,0,0,0.08);
      margin-top: 14px;
    }
    @media (max-width: 860px) { img.photo { height: 260px; } }

    .codebox {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size: 13px;
      line-height: 1.55;
      background: rgba(255,255,255,0.40);
      border: 1px solid rgba(0,0,0,0.12);
      border-radius: 14px;
      padding: 12px;
      white-space: pre;
      overflow-x: auto;
      text-align: left;
      margin-top: 14px;
    }

    input[type="text"] {
      width: min(680px, 100%);
      box-sizing: border-box;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(0,0,0,0.14);
      background: rgba(255,255,255,0.55);
      color: var(--text);
      font-size: 14px;
      outline: none;
      margin-top: 12px;
    }

    .stage {
      position: relative;
      width: 100%;
      height: 340px;
      border-radius: 14px;
      border: 1px solid rgba(0,0,0,0.12);
      background: rgba(255,255,255,0.30);
      overflow: hidden;
      padding: 14px;
      margin-top: 14px;
      display: grid;
      place-items: center;
    }

    .floating {
      position: absolute;
      left: 62%;
      top: 62%;
      min-width: 170px;
    }

    .photos {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 14px;
      width: 100%;
    }
    .photos img {
      width: 100%;
      height: 170px;
      object-fit: cover;
      border-radius: 14px;
      border: 1px solid rgba(0,0,0,0.12);
      background: rgba(0,0,0,0.08);
    }
    @media (max-width: 860px) {
      .photos { grid-template-columns: 1fr; }
      .photos img { height: 220px; }
    }

    .footer {
      text-align:center;
      margin-top: 14px;
      color: rgba(234,246,255,0.78);
      font-size: 14px;
    }

    /* Shrimp burst */
.shrimp {
  position: fixed;
  left: 0;
  top: 0;
  font-size: 28px;
  pointer-events: none;
  z-index: 9999;
  transform: translate(-50%, -50%);
  will-change: transform, opacity;
}

  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <header id="appHeader">
        <h1 id="titleText">For my marine biologist boyfriend</h1>
        <p class="subtitle" id="subtitleText">Complete the tasks to unlock the final message.</p>

        <!-- progress dots (hidden on start screen, shown once game begins) -->
        <div class="progress" id="progress" style="display:none;">
          <div class="dot" data-step="coral"></div>
          <div class="dot" data-step="nick"></div>
          <div class="dot" data-step="code"></div>
          <div class="dot" data-step="val"></div>
          <div class="dot" data-step="love"></div>
        </div>
      </header>

      <div class="content">

        <!-- SCREEN: Start -->
        <section id="screen-start" class="screen active">
          <div class="panel" id="panel-start">
            <p class="hint">
              Rules: A Passionate kiss has to be given to the game master for every round.
            </p>
            <div class="btns">
              <button id="startBtn" class="primary" type="button">Start</button>
            </div>
          </div>
        </section>

        <!-- SCREEN: Task 1 (Coral) -->
        <section id="screen-coral" class="screen">
          <div class="panel" id="panel-coral">
            <p class="hint" id="coralPrompt">Nameeee that coral</p>
            <img id="coralImg" class="photo" src="" alt="Coral photo" />
            <div id="coralChoices" class="btns"></div>
            <div id="coralStatus" class="status"></div>
            <div class="btns">
              <button id="skipCoral" class="danger" type="button">Skip</button>
            </div>
          </div>
        </section>

        <!-- SCREEN: Task 2 (Placeholder: you will replace this later)
             Remove this entire screen if you don‚Äôt want it, or rename it and add your new task.
        -->
        <section id="screen-nick" class="screen">
          <div class="panel" id="panel-nick">
            <p class="hint" id="nickPrompt">Pick the correct answer.</p>
            <div class="codebox" id="nickQuestion"></div>
            <div id="nickChoices" class="btns"></div>
            <div id="nickStatus" class="status"></div>
            <div class="btns">
              <button id="skipNick" class="danger" type="button">Skip</button>
            </div>
          </div>
        </section>

        <!-- SCREEN: Task 3 (R code) -->
        <section id="screen-code" class="screen">
          <div class="panel" id="panel-code">
            <p class="hint" id="codePrompt">Fill the missing line with a mutate(...) that uses thing_you_like_about_me (pipes welcome).</p>
            <div class="codebox" id="rSnippet"></div>
            <input id="codeInput" type="text" placeholder="Type the missing R line here" />
            <div class="btns">
              <button id="checkCode" class="good" type="button">Check</button>
              <button id="skipCode" class="danger" type="button">Skip</button>
            </div>
            <div id="codeStatus" class="status"></div>
          </div>
        </section>

        <!-- SCREEN: Valentine -->
        <section id="screen-val" class="screen">
          <div class="panel" id="panel-val">
            <p class="hint" id="valPrompt">Will you be my Valentine?</p>
            <div class="stage" id="stage">
              <div style="text-align:center; max-width: 60ch;">
                <p class="hint" id="valSubPrompt">Select your answer.</p>
                <div class="btns">
                  <button id="yesBtn" class="primary" type="button">Yes</button>
                </div>
              </div>
              <button id="noBtn" class="danger floating" type="button">No</button>
            </div>
          </div>
        </section>

        <!-- SCREEN: Love -->
        <section id="screen-love" class="screen">
          <div class="panel" id="panel-love">
            <div id="loveText" style="font-size: 18px; line-height: 1.55;"></div>

            <div class="photos">
              <!-- Put images in /images/ and update filenames below -->
              <img src="images/us1.JPG" alt="Photo 1" />
              <img src="images/us2.JPG" alt="Photo 2" />
              <img src="images/us3.jpeg" alt="Photo 3" />
            </div>

            <div class="btns">
              <button id="replay" class="good" type="button">Replay</button>
            </div>
          </div>
        </section>

      </div>
    </div>

    <div class="footer">Built for one specific shrimp outta the million shrimp</div>
  </div>

  <script>
    /* ============================================================
      Level titles (header changes after Start)
    ============================================================ */
    const LEVEL_TITLES = {
      coral: { title: "Task 1: Coral ID", subtitle: "Corally bits you should know" },
      nick:  { title: "Task 2: Nicknames", subtitle: "There's too many to count, but whats the best?." },
      code:  { title: "Task 3: RStudio", subtitle: "For the coder in you." },
      val:   { title: "Final Task", subtitle: "This one should be easy. Allegedly." },
      love:  { title: "Unlocked", subtitle: "" }
    };

    /* ============================================================
      Coral quiz content
      - Put coral images in /images/
      - Update src filenames
      - Make sure filenames match exactly (case-sensitive on GitHub Pages)
    ============================================================ */
    const CORAL_QUIZ = [
      {
        src: "images/acropora.png",
        correct: "Acropora loripes",
        options: ["Acropora loripes", "Pocillopora damicornis", "Montipora digitata", "Porites lobata"]
      },
      {
        src: "images/stylophora.png",
        correct: "Stylophora pistillata",
        options: ["Pocillopora damicornis", "Acropora tenuis", "Favia sp.", "Stylophora pistillata"]
      }
    ];

    /* ============================================================
      Nicknames task (placeholder)
      - Replace EDIT_ME_* values
      - Or replace this entire screen with your new task logic
    ============================================================ */
    const NICK_TASK = {
      question: [
        "I love them all but which one's my favourite?"
      ].join("\n"),
      correct: "Trouble",
      options: [
        "Trouble",
        "Pigot",
        "Paperclip",
         "Goose",
         "Shrimp",
         "Honey",
         "Mi amor",
         "Sweetheart",
        "Speedbump"
      ]
    };

    /* ============================================================
      R code task (multiple acceptable answers)
      - Replace snippet and accepted lines
    ============================================================ */
    const R_SNIPPET = `
library(dplyr)

me <- tibble(
  thing_you_like_about_me = c("my laugh", "my brain", "my butt"),
  score = c(100, 100, 100)
)

me %>%
  ??? %>%   # add a column called love_note using mutate()
  arrange(desc(score))
`.trim();



    const LOVE_MESSAGE_HTML = `
      <p><b>Good soup.</b></p>
      <p>
        Excellent job getting through the tasks, the game master is waiting for the sloppiest, most passionate kisses.
        Well done with the students. there was never any doubt that you'd crush it and you absolutely did. I am super proud of you!
        I love talking corals, birds and codes with you but most importantly, I love doing life with you. 
      </p>
      <p>
        Thank you for being an incredible boyfriend that makes me laugh.
        I'm sick of this long distance shit and can‚Äôt wait to celebrate together in Fiji soon.
      </p>
      <p>
        You'll get your prize on the 15th (as will I) xx
      </p>
    `;

    /* ------------------ DOM refs ------------------ */
    const appHeader = document.getElementById("appHeader");
    const titleText = document.getElementById("titleText");
    const subtitleText = document.getElementById("subtitleText");
    const progress = document.getElementById("progress");

    const screens = {
      start: document.getElementById("screen-start"),
      coral: document.getElementById("screen-coral"),
      nick:  document.getElementById("screen-nick"),
      code:  document.getElementById("screen-code"),
      val:   document.getElementById("screen-val"),
      love:  document.getElementById("screen-love"),
    };

    function showScreen(key) {
      Object.values(screens).forEach(s => s.classList.remove("active"));
      screens[key].classList.add("active");
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    function setProgress(activeKey) {
      const dots = [...document.querySelectorAll(".dot")];
      dots.forEach(d => {
        const step = d.getAttribute("data-step");
        d.classList.remove("active");
        if (step === activeKey) d.classList.add("active");
      });
    }

    function markDone(stepKey) {
      const dot = document.querySelector(`.dot[data-step="${stepKey}"]`);
      if (dot) dot.classList.add("done");
    }

    function shuffle(arr) {
      const a = [...arr];
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    function shrimpBurst({
  count = 90,
  durationMs = 1400,
  spread = 520
} = {}) {
  const emojis = ["ü¶ê", "üç§"]; // shrimp + prawn tempura energy

  const centerX = window.innerWidth / 2;
  const centerY = window.innerHeight / 3;

  for (let i = 0; i < count; i++) {
    const el = document.createElement("div");
    el.className = "shrimp";
    el.textContent = emojis[Math.floor(Math.random() * emojis.length)];

    const angle = Math.random() * Math.PI * 2;
    const radius = Math.random() * spread;
    const dx = Math.cos(angle) * radius;
    const dy = Math.sin(angle) * radius;

    const rotate = (Math.random() * 720 - 360);
    const driftY = 220 + Math.random() * 260; // extra fall

    el.style.left = `${centerX}px`;
    el.style.top = `${centerY}px`;
    el.style.opacity = "1";

    document.body.appendChild(el);

    el.animate(
      [
        { transform: `translate(-50%, -50%) translate(0px, 0px) rotate(0deg) scale(1)`, opacity: 1 },
        { transform: `translate(-50%, -50%) translate(${dx}px, ${dy + driftY}px) rotate(${rotate}deg) scale(${0.8 + Math.random() * 0.6})`, opacity: 0 }
      ],
      {
        duration: durationMs + Math.random() * 500,
        easing: "cubic-bezier(.15,.8,.2,1)",
        fill: "forwards"
      }
    );

    setTimeout(() => el.remove(), durationMs + 900);
  }
}

    function normalizeLine(s) {
      return s.trim().replace(/;$/, "").replace(/\s+/g, " ");
    }

    function equalsLoose(a, b) {
      const na = normalizeLine(a).replace(/^dplyr::/i, "");
      const nb = normalizeLine(b).replace(/^dplyr::/i, "");
      return na === nb;
    }

    function stripStrings(s) {
  // Remove string literals to avoid people gaming the check with just "thing_you_like_about_me" in quotes
  return s.replace(/"([^"\\]|\\.)*"/g, '""').replace(/'([^'\\]|\\.)*'/g, "''");
}

function isValidMutateLine(input) {
  const raw = input.trim();
  if (!raw) return false;

  // Normalize spacing and ignore trailing semicolons
  const line = normalizeLine(raw);

  // Must contain mutate( ... )
  const hasMutate = /\b(?:dplyr::)?mutate\s*\(/i.test(line);
  if (!hasMutate) return false;

  // Must reference the existing column (not only inside quotes)
  const noStrings = stripStrings(line);
  const mentionsCol = /\bthing_you_like_about_me\b/.test(noStrings);
  if (!mentionsCol) return false;

  // Strong nudge: encourage creating love_note, but don't require it
  // If you DO want to require love_note specifically, uncomment the next two lines:
  // const makesLoveNote = /\blove_note\s*=/.test(noStrings);
  // if (!makesLoveNote) return false;

  return true;
}


    async function transitionHeaderTo(levelKey) {
      const cfg = LEVEL_TITLES[levelKey];
      if (!cfg) return;

      appHeader.classList.add("fading");
      await new Promise(r => setTimeout(r, 240));
      titleText.textContent = cfg.title;
      subtitleText.textContent = cfg.subtitle || "";
      appHeader.classList.remove("fading");
      await new Promise(r => setTimeout(r, 60));

      setProgress(levelKey);
    }

    async function transitionPanel(panelEl, nextKey, headerLevelKey) {
      panelEl.classList.add("fading");
      await new Promise(r => setTimeout(r, 240));

      if (headerLevelKey) await transitionHeaderTo(headerLevelKey);

      showScreen(nextKey);

      const nextPanel = document.querySelector(`#screen-${nextKey} .panel`);
      if (nextPanel) {
        nextPanel.classList.add("fading");
        requestAnimationFrame(() => nextPanel.classList.remove("fading"));
      }
    }

    /* ------------------ Start -> Coral ------------------ */
    document.getElementById("startBtn").addEventListener("click", async () => {
      progress.style.display = "flex";   // show progress once game begins
      await transitionPanel(document.getElementById("panel-start"), "coral", "coral");
      renderCoralQuiz();
    });

    /* ------------------ Task 1: Coral quiz ------------------ */
    let coralIndex = 0;
    const coralImg = document.getElementById("coralImg");
    const coralChoices = document.getElementById("coralChoices");
    const coralStatus = document.getElementById("coralStatus");

    function renderCoralQuiz() {
      coralStatus.textContent = "";
      coralStatus.className = "status";
      const q = CORAL_QUIZ[coralIndex];

      coralImg.src = q.src;
      coralImg.onerror = () => {
        coralStatus.textContent = "Image not found. Check CORAL_QUIZ.src and filename casing.";
        coralStatus.className = "status no";
      };

      coralChoices.innerHTML = "";
      shuffle(q.options).forEach(opt => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.textContent = opt;
        btn.addEventListener("click", () => handleCoralChoice(opt));
        coralChoices.appendChild(btn);
      });
    }

    async function handleCoralChoice(opt) {
      const q = CORAL_QUIZ[coralIndex];
      if (opt === q.correct) {
        coralStatus.textContent = "Correct.";
        coralStatus.className = "status ok";
        await new Promise(r => setTimeout(r, 420));
        coralIndex++;

        if (coralIndex >= CORAL_QUIZ.length) {
          markDone("coral");
          await transitionPanel(document.getElementById("panel-coral"), "nick", "nick");
          renderNickTask();
        } else {
          renderCoralQuiz();
        }
      } else {
        coralStatus.textContent = "Incorrect. Try again.";
        coralStatus.className = "status no";
      }
    }

    document.getElementById("skipCoral").addEventListener("click", async () => {
      markDone("coral");
      await transitionPanel(document.getElementById("panel-coral"), "nick", "nick");
      renderNickTask();
    });

    /* ------------------ Task 2: Nicknames placeholder ------------------ */
    const nickQuestion = document.getElementById("nickQuestion");
    const nickChoices = document.getElementById("nickChoices");
    const nickStatus = document.getElementById("nickStatus");

    function renderNickTask() {
      nickStatus.textContent = "";
      nickStatus.className = "status";
      nickQuestion.textContent = NICK_TASK.question;

      nickChoices.innerHTML = "";
      shuffle(NICK_TASK.options).forEach(opt => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.textContent = opt;
        btn.addEventListener("click", async () => {
          if (opt === NICK_TASK.correct) {
            nickStatus.textContent = "Correct.";
            nickStatus.className = "status ok";
            await new Promise(r => setTimeout(r, 420));
            markDone("nick");
            await transitionPanel(document.getElementById("panel-nick"), "code", "code");
            renderCodeTask();
          } else {
            nickStatus.textContent = "Incorrect. Try again.";
            nickStatus.className = "status no";
          }
        });
        nickChoices.appendChild(btn);
      });
    }

    document.getElementById("skipNick").addEventListener("click", async () => {
      markDone("nick");
      await transitionPanel(document.getElementById("panel-nick"), "code", "code");
      renderCodeTask();
    });

    /* ------------------ Task 3: R code ------------------ */
    const rSnippet = document.getElementById("rSnippet");
    const codeInput = document.getElementById("codeInput");
    const codeStatus = document.getElementById("codeStatus");

    function renderCodeTask() {
      rSnippet.textContent = R_SNIPPET;
      codeInput.value = "";
      codeStatus.textContent = "";
      codeStatus.className = "status";
    }

    document.getElementById("checkCode").addEventListener("click", async () => {
  const typed = codeInput.value;

  if (!typed.trim()) {
    codeStatus.textContent = "Type the missing line (a mutate() line) üíõ";
    codeStatus.className = "status no";
    return;
  }

  if (isValidMutateLine(typed)) {
    codeStatus.textContent = "Nailed it. Tidyverse romance unlocked ü¶ê";
    codeStatus.className = "status ok";

    await new Promise(r => setTimeout(r, 420));
    markDone("code");
    await transitionPanel(document.getElementById("panel-code"), "val", "val");
    moveNoButton();
  } else {
    codeStatus.textContent = "Close ‚Äî it needs a mutate(...) that uses thing_you_like_about_me.";
    codeStatus.className = "status no";
  }
});


    document.getElementById("skipCode").addEventListener("click", async () => {
      markDone("code");
      await transitionPanel(document.getElementById("panel-code"), "val", "val");
      moveNoButton();
    });

    /* ------------------ Valentine: moving No button ------------------ */
    const stage = document.getElementById("stage");
    const noBtn = document.getElementById("noBtn");
    const yesBtn = document.getElementById("yesBtn");

    function moveNoButton() {
      const stageRect = stage.getBoundingClientRect();
      const btnRect = noBtn.getBoundingClientRect();

      const padding = 14;
      const maxX = stageRect.width - btnRect.width - padding;
      const maxY = stageRect.height - btnRect.height - padding;

      const x = Math.max(padding, Math.floor(Math.random() * maxX));
      const y = Math.max(padding, Math.floor(Math.random() * maxY));

      noBtn.style.left = `${x}px`;
      noBtn.style.top = `${y}px`;
    }

    stage.addEventListener("mousemove", (e) => {
      const btn = noBtn.getBoundingClientRect();
      const dx = e.clientX - (btn.left + btn.width / 2);
      const dy = e.clientY - (btn.top + btn.height / 2);
      const dist = Math.sqrt(dx*dx + dy*dy);
      if (dist < 140) moveNoButton();
    });

    noBtn.addEventListener("mouseenter", moveNoButton);
    noBtn.addEventListener("click", (e) => { e.preventDefault(); moveNoButton(); });

yesBtn.addEventListener("click", async () => {
  markDone("val");

  // SHRIMP CONFETTI MOMENT
  shrimpBurst({ count: 140, durationMs: 1500, spread: 600 });

  document.getElementById("loveText").innerHTML = LOVE_MESSAGE_HTML;
  await transitionPanel(document.getElementById("panel-val"), "love", "love");
  markDone("love");
});


    /* ------------------ Replay ------------------ */
    document.getElementById("replay").addEventListener("click", async () => {
      coralIndex = 0;

      // reset header to start message and hide progress
      appHeader.classList.add("fading");
      await new Promise(r => setTimeout(r, 240));
      titleText.textContent = "For my marine biologist boyfriend";
      subtitleText.textContent = "Complete the tasks to unlock the final message.";
      appHeader.classList.remove("fading");

      progress.style.display = "none";
      document.querySelectorAll(".dot").forEach(d => d.classList.remove("active", "done"));

      showScreen("start");
      document.getElementById("panel-start").classList.remove("fading");
    });

    // initial placement
    moveNoButton();
  </script>
</body>
</html>
