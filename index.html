<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Valentine Game</title>

  <style>
    :root {
      --bg: #071a2b;
      --card: rgba(255,255,255,0.08);
      --text: #eaf6ff;
      --muted: rgba(234,246,255,0.78);
      --accent: #ff5aa5;
      --accent2: #4fe3c2;
      --danger: #ff6b6b;
      --shadow: 0 12px 40px rgba(0,0,0,0.35);
      --radius: 18px;
    }

    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color: var(--text);
      background:
        radial-gradient(1000px 600px at 20% 10%, rgba(79,227,194,0.16), transparent 60%),
        radial-gradient(900px 600px at 85% 20%, rgba(255,90,165,0.14), transparent 55%),
        radial-gradient(900px 700px at 40% 90%, rgba(100,149,237,0.18), transparent 60%),
        var(--bg);
      min-height: 100vh;
      display: grid;
      place-items: center;
      padding: 22px;
    }

    .wrap { width: min(920px, 100%); }

    .card {
      background: var(--card);
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
    }

    header {
      padding: 22px 22px 14px;
      border-bottom: 1px solid rgba(255,255,255,0.12);
    }

    h1 {
      margin: 0 0 6px 0;
      font-size: clamp(22px, 3vw, 32px);
      letter-spacing: 0.2px;
      font-weight: 800;
    }

    .subtitle { margin: 0; color: var(--muted); line-height: 1.4; }

    .content { padding: 22px; display: grid; gap: 16px; }

    .panel {
      background: rgba(0,0,0,0.18);
      border: 1px solid rgba(255,255,255,0.10);
      border-radius: 14px;
      padding: 16px;
    }

    .hint { color: var(--muted); font-size: 14px; line-height: 1.4; }

    .btns { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 12px; }
    button {
      appearance: none;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(255,255,255,0.10);
      color: var(--text);
      padding: 10px 14px;
      border-radius: 12px;
      font-weight: 650;
      cursor: pointer;
      transition: transform 0.08s ease, background 0.2s ease, border 0.2s ease;
      user-select: none;
    }
    button:hover { transform: translateY(-1px); background: rgba(255,255,255,0.14); }
    button:active { transform: translateY(0px) scale(0.99); }

    .primary { border-color: rgba(255,90,165,0.55); background: rgba(255,90,165,0.20); }
    .primary:hover { background: rgba(255,90,165,0.28); }

    .good { border-color: rgba(79,227,194,0.55); background: rgba(79,227,194,0.18); }
    .good:hover { background: rgba(79,227,194,0.25); }

    .danger { border-color: rgba(255,107,107,0.55); background: rgba(255,107,107,0.18); }
    .danger:hover { background: rgba(255,107,107,0.25); }

    .status { font-weight: 750; margin-top: 10px; }
    .status.ok { color: var(--accent2); }
    .status.no { color: var(--danger); }

    img.photo {
      width: 100%;
      height: 320px;
      object-fit: cover;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(0,0,0,0.25);
    }
    @media (max-width: 860px) { img.photo { height: 260px; } }

    .codebox {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size: 13px;
      line-height: 1.5;
      background: rgba(0,0,0,0.35);
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 14px;
      padding: 12px;
      white-space: pre;
      overflow-x: auto;
    }

    input[type="text"] {
      width: 100%;
      box-sizing: border-box;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(0,0,0,0.25);
      color: var(--text);
      font-size: 14px;
      outline: none;
    }

    .screen { display: none; }
    .screen.active { display: block; }

    .stage {
      position: relative;
      height: 340px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(0,0,0,0.20);
      overflow: hidden;
      padding: 14px;
    }
    .floating { position: absolute; left: 60%; top: 55%; }

    .photos {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 12px;
    }
    .photos img {
      width: 100%;
      height: 160px;
      object-fit: cover;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(0,0,0,0.25);
    }
    @media (max-width: 860px) {
      .photos { grid-template-columns: 1fr; }
      .photos img { height: 220px; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <header>
        <h1>For my coder, marine biologist boyfriend...</h1>
        <p class="subtitle" id="topSubtitle">
          <!-- EDIT THIS: intro line shown on the start screen -->
          I made you a small game. Complete the tasks to unlock the final message.
        </p>
      </header>

      <div class="content">

        <!-- SCREEN 0: Start -->
        <section id="screen-start" class="screen active">
          <div class="panel">
            <div class="hint">
              <!-- EDIT THIS: start screen body -->
              Rules: no googling, no arguing with the UI, and absolutely no pretending you don't know what an underscore is.
            </div>
            <div class="btns">
              <button id="startBtn" class="primary" type="button">Start</button>
            </div>
          </div>
        </section>

        <!-- SCREEN 1: Coral ID quiz -->
        <section id="screen-coral" class="screen">
          <div class="panel">
            <div class="hint" id="coralPrompt">
              <!-- EDIT THIS: coral task prompt -->
              Task 1: Identify the coral.
            </div>

            <div style="margin-top:12px">
              <img id="coralImg" class="photo" src="" alt="Coral photo" />
            </div>

            <div id="coralChoices" class="btns"></div>
            <div id="coralStatus" class="status"></div>

            <div class="btns" style="margin-top:14px">
              <button id="skipCoral" class="danger" type="button">Skip</button>
            </div>
          </div>
        </section>

        <!-- SCREEN 2: Surfing task -->
        <section id="screen-surf" class="screen">
          <div class="panel">
            <div class="hint" id="surfPrompt">
              <!-- EDIT THIS: surfing task prompt -->
              Task 2: Surf check. Choose the correct answer.
            </div>

            <div class="codebox" id="surfQuestion"></div>
            <div id="surfChoices" class="btns"></div>
            <div id="surfStatus" class="status"></div>

            <div class="btns" style="margin-top:14px">
              <button id="skipSurf" class="danger" type="button">Skip</button>
            </div>
          </div>
        </section>

        <!-- SCREEN 3: Nicknames / about-you quiz -->
        <section id="screen-nick" class="screen">
          <div class="panel">
            <div class="hint" id="nickPrompt">
              <!-- EDIT THIS: nickname task prompt -->
              Task 3: Nickname audit. Pick the real one.
            </div>

            <div class="codebox" id="nickQuestion"></div>
            <div id="nickChoices" class="btns"></div>
            <div id="nickStatus" class="status"></div>

            <div class="btns" style="margin-top:14px">
              <button id="skipNick" class="danger" type="button">Skip</button>
            </div>
          </div>
        </section>

        <!-- SCREEN 4: R code task -->
        <section id="screen-code" class="screen">
          <div class="panel">
            <div class="hint" id="codePrompt">
              <!-- EDIT THIS: code task prompt -->
              Task 4: Finish the R code. Do not forget the underscores.
            </div>

            <div class="codebox" id="rSnippet"></div>

            <div style="margin-top:10px">
              <input id="codeInput" type="text" placeholder="Type the missing R line here" />
            </div>

            <div class="btns">
              <button id="checkCode" class="good" type="button">Check</button>
              <button id="skipCode" class="danger" type="button">Skip</button>
            </div>

            <div id="codeStatus" class="status"></div>
          </div>
        </section>

        <!-- SCREEN 5: Valentine question -->
        <section id="screen-val" class="screen">
          <div class="panel">
            <div class="hint" id="valPrompt">
              <!-- EDIT THIS: valentine question -->
              Final task: Will you be my Valentine?
            </div>

            <div class="stage" id="stage">
              <div style="max-width: 520px; margin-top: 10px;">
                <div class="hint" id="valSubPrompt">
                  <!-- EDIT THIS: small subtext -->
                  Select your answer.
                </div>

                <div class="btns" style="margin-top:14px">
                  <button id="yesBtn" class="primary" type="button">Yes</button>
                </div>
              </div>

              <button id="noBtn" class="danger floating" type="button">No</button>
            </div>
          </div>
        </section>

        <!-- SCREEN 6: Love message -->
        <section id="screen-love" class="screen">
          <div class="panel">
            <div id="loveText" style="font-size: 18px; line-height: 1.55;"></div>

            <div class="photos">
              <!-- EDIT THESE:
                   1) Put your images in an /images/ folder in the repo
                   2) Replace the filenames below (or delete extra <img> tags)
              -->
              <img src="images/us1.jpg" alt="Photo 1" />
              <img src="images/us2.jpg" alt="Photo 2" />
              <img src="images/fiji.jpg" alt="Photo 3" />
            </div>

            <div class="btns" style="margin-top: 14px;">
              <button id="replay" class="good" type="button">Replay</button>
            </div>
          </div>
        </section>

      </div>
    </div>

    <p class="hint" style="text-align:center; margin-top: 14px;">
      <!-- EDIT THIS: footer line -->
      Built for one specific marine biologist.
    </p>
  </div>

  <script>
    /* ============================================================
      EDIT SECTION A: Coral quiz content
      - Put coral images in /images/
      - Replace src paths with your filenames
      - Add/remove quiz entries as you like
      - If you want his favourite: set correct: "Acropora loripes" for one entry
    ============================================================ */
    const CORAL_QUIZ = [
      {
        src: "images/coral1.jpg",
        correct: "Acropora loripes",
        options: ["Acropora loripes", "Pocillopora damicornis", "Montipora digitata", "Porites lobata"]
      },
      {
        src: "images/coral2.jpg",
        correct: "Pocillopora damicornis",
        options: ["Pocillopora damicornis", "Acropora tenuis", "Favia sp.", "Stylophora pistillata"]
      },
      {
        src: "images/coral3.jpg",
        correct: "Porites lobata",
        options: ["Porites lobata", "Acropora millepora", "Montipora capricornis", "Goniastrea sp."]
      }
    ];

    /* ============================================================
      EDIT SECTION B: Surfing task
      - Make it as inside-jokey as you want
      - Keep one option exactly matching `correct`
      - You can add more tasks by copying the same structure and chaining screens
    ============================================================ */
    const SURF_TASK = {
      question: [
        "Scenario:",
        "Waist-to-chest high, punchy beach break, a bit of wind on it.",
        "You want speed but also some control.",
        "",
        "Pick the best call:"
      ].join("\n"),
      correct: "Take the board that paddles easiest and go slightly bigger fins for hold.",
      options: [
        "Take the board that paddles easiest and go slightly bigger fins for hold.",
        "Take the smallest board possible and refuse to paddle.",
        "Wax is optional. Commitment is optional. Sand is inevitable.",
        "Ride it switch-stance only. The ocean respects chaos."
      ]
    };

    /* ============================================================
      EDIT SECTION C: Nicknames / about-you task
      - If you want multiple nickname questions, turn this into an array like CORAL_QUIZ
    ============================================================ */
    const NICK_TASK = {
      question: [
        "One of these is a real nickname you've used for me.",
        "Pick the correct one."
      ].join("\n"),
      correct: "EDIT_ME_REAL_NICKNAME",
      options: [
        "EDIT_ME_REAL_NICKNAME",
        "EDIT_ME_FAKE_NICKNAME_1",
        "EDIT_ME_FAKE_NICKNAME_2",
        "EDIT_ME_FAKE_NICKNAME_3"
      ]
    };

    /* ============================================================
      EDIT SECTION D: R code task (multiple acceptable answers)
      - Replace the snippet to match your vibe
      - Add multiple acceptable lines in CODE_ACCEPTED
      - The checker is forgiving about whitespace, trailing semicolons, and `dplyr::` prefixes
    ============================================================ */
    const R_SNIPPET = `
library(dplyr)

me <- tibble(
  trait = c("kind", "funny", "brilliant"),
  score = c(100, 100, 100)
)

me %>%
  ??? %>%                             # fill this line (do not forget underscores)
  arrange(desc(score))
`.trim();

    // Put the line(s) you want him to type for ??? below.
    // He can match ANY ONE of these to pass.
    // Tips:
    // - Include a version with `dplyr::mutate(...)` if he tends to type it
    // - Include a version with different column names if you change the snippet
    const CODE_ACCEPTED = [
      'mutate(favourite_thing = trait == "kind")',
      'mutate(favourite_thing = trait == "funny")',
      'mutate(favourite_thing = trait == "brilliant")',
      'dplyr::mutate(favourite_thing = trait == "kind")',
      'dplyr::mutate(favourite_thing = trait == "funny")',
      'dplyr::mutate(favourite_thing = trait == "brilliant")'
    ];

    /* ============================================================
      EDIT SECTION E: Final love message
      - Write whatever you want in HTML
      - Keep it short or make it a whole letter
    ============================================================ */
    const LOVE_MESSAGE_HTML = `
      <p><b>Good.</b></p>
      <p>
        I love doing life with you. The reef talk, the surf talk, the code talk, the everything.
        Thanks for being you, and for teaching me so much (especially pipes).
      </p>
      <p>
        I’m really happy you’re my partner. I can’t wait to celebrate together in Fiji soon.
      </p>
      <p>
        Come collect your prize.
      </p>
    `;

    /* ------------------ Helpers + state ------------------ */
    const screens = {
      start: document.getElementById("screen-start"),
      coral: document.getElementById("screen-coral"),
      surf:  document.getElementById("screen-surf"),
      nick:  document.getElementById("screen-nick"),
      code:  document.getElementById("screen-code"),
      val:   document.getElementById("screen-val"),
      love:  document.getElementById("screen-love"),
    };

    function showScreen(key) {
      Object.values(screens).forEach(s => s.classList.remove("active"));
      screens[key].classList.add("active");
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    function shuffle(arr) {
      const a = [...arr];
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    function normalizeLine(s) {
      return s
        .trim()
        .replace(/;$/, "")
        .replace(/\s+/g, " ")
        .replace(/^dplyr::/i, "dplyr::"); // consistent casing
    }

    function equalsLoose(a, b) {
      // Treat `mutate(...)` and `dplyr::mutate(...)` as equivalent if you want:
      // (We already include both in CODE_ACCEPTED, but this also helps.)
      const na = normalizeLine(a).replace(/^dplyr::/i, "");
      const nb = normalizeLine(b).replace(/^dplyr::/i, "");
      return na === nb;
    }

    /* ------------------ Start screen ------------------ */
    document.getElementById("startBtn").addEventListener("click", () => {
      // Optional: change header/subtitle once the game starts
      // document.querySelector("h1").textContent = "Task sequence initiated";
      showScreen("coral");
      renderCoralQuiz();
    });

    /* ------------------ Task 1: Coral quiz ------------------ */
    let coralIndex = 0;

    const coralImg = document.getElementById("coralImg");
    const coralChoices = document.getElementById("coralChoices");
    const coralStatus = document.getElementById("coralStatus");

    function renderCoralQuiz() {
      coralStatus.textContent = "";
      coralStatus.className = "status";

      const q = CORAL_QUIZ[coralIndex];
      coralImg.src = q.src;

      coralImg.onerror = () => {
        coralStatus.textContent =
          "Image not found. Put a file at that path (e.g. images/coral1.jpg) or update CORAL_QUIZ.src.";
        coralStatus.className = "status no";
      };

      coralChoices.innerHTML = "";
      shuffle(q.options).forEach(opt => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.textContent = opt;
        btn.addEventListener("click", () => handleCoralChoice(opt));
        coralChoices.appendChild(btn);
      });
    }

    function handleCoralChoice(opt) {
      const q = CORAL_QUIZ[coralIndex];
      if (opt === q.correct) {
        coralStatus.textContent = "Correct.";
        coralStatus.className = "status ok";
        setTimeout(() => {
          coralIndex++;
          if (coralIndex >= CORAL_QUIZ.length) {
            showScreen("surf");
            renderSurfTask();
          } else {
            renderCoralQuiz();
          }
        }, 650);
      } else {
        coralStatus.textContent = "Incorrect. Try again.";
        coralStatus.className = "status no";
      }
    }

    document.getElementById("skipCoral").addEventListener("click", () => {
      showScreen("surf");
      renderSurfTask();
    });

    /* ------------------ Task 2: Surfing ------------------ */
    const surfQuestion = document.getElementById("surfQuestion");
    const surfChoices = document.getElementById("surfChoices");
    const surfStatus = document.getElementById("surfStatus");

    function renderSurfTask() {
      surfStatus.textContent = "";
      surfStatus.className = "status";
      surfQuestion.textContent = SURF_TASK.question;

      surfChoices.innerHTML = "";
      shuffle(SURF_TASK.options).forEach(opt => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.textContent = opt;
        btn.addEventListener("click", () => {
          if (opt === SURF_TASK.correct) {
            surfStatus.textContent = "Correct.";
            surfStatus.className = "status ok";
            setTimeout(() => {
              showScreen("nick");
              renderNickTask();
            }, 650);
          } else {
            surfStatus.textContent = "Nope. Try again.";
            surfStatus.className = "status no";
          }
        });
        surfChoices.appendChild(btn);
      });
    }

    document.getElementById("skipSurf").addEventListener("click", () => {
      showScreen("nick");
      renderNickTask();
    });

    /* ------------------ Task 3: Nickname task ------------------ */
    const nickQuestion = document.getElementById("nickQuestion");
    const nickChoices = document.getElementById("nickChoices");
    const nickStatus = document.getElementById("nickStatus");

    function renderNickTask() {
      nickStatus.textContent = "";
      nickStatus.className = "status";
      nickQuestion.textContent = NICK_TASK.question;

      nickChoices.innerHTML = "";
      shuffle(NICK_TASK.options).forEach(opt => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.textContent = opt;
        btn.addEventListener("click", () => {
          if (opt === NICK_TASK.correct) {
            nickStatus.textContent = "Correct.";
            nickStatus.className = "status ok";
            setTimeout(() => {
              showScreen("code");
              renderCodeTask();
            }, 650);
          } else {
            nickStatus.textContent = "Incorrect. Try again.";
            nickStatus.className = "status no";
          }
        });
        nickChoices.appendChild(btn);
      });
    }

    document.getElementById("skipNick").addEventListener("click", () => {
      showScreen("code");
      renderCodeTask();
    });

    /* ------------------ Task 4: R code ------------------ */
    const rSnippet = document.getElementById("rSnippet");
    const codeInput = document.getElementById("codeInput");
    const checkCode = document.getElementById("checkCode");
    const skipCode = document.getElementById("skipCode");
    const codeStatus = document.getElementById("codeStatus");

    function renderCodeTask() {
      rSnippet.textContent = R_SNIPPET;
      codeInput.value = "";
      codeStatus.textContent = "";
      codeStatus.className = "status";
    }

    checkCode.addEventListener("click", () => {
      const typedRaw = codeInput.value;
      const typed = normalizeLine(typedRaw);

      if (!typed) {
        codeStatus.textContent = "Type the missing line.";
        codeStatus.className = "status no";
        return;
      }

      const matched = CODE_ACCEPTED.some(acc => equalsLoose(typed, acc));

      if (matched) {
        codeStatus.textContent = "Pass.";
        codeStatus.className = "status ok";
        setTimeout(() => showScreen("val"), 650);
      } else {
        codeStatus.textContent = "Not quite. Hint: underscores matter.";
        codeStatus.className = "status no";
      }
    });

    skipCode.addEventListener("click", () => showScreen("val"));

    /* ------------------ Valentine screen: moving No button ------------------ */
    const stage = document.getElementById("stage");
    const noBtn = document.getElementById("noBtn");
    const yesBtn = document.getElementById("yesBtn");

    function moveNoButton() {
      const stageRect = stage.getBoundingClientRect();
      const btnRect = noBtn.getBoundingClientRect();

      const padding = 12;
      const maxX = stageRect.width - btnRect.width - padding;
      const maxY = stageRect.height - btnRect.height - padding;

      const x = Math.max(padding, Math.floor(Math.random() * maxX));
      const y = Math.max(padding, Math.floor(Math.random() * maxY));

      noBtn.style.left = `${x}px`;
      noBtn.style.top = `${y}px`;
    }

    stage.addEventListener("mousemove", (e) => {
      const btn = noBtn.getBoundingClientRect();
      const dx = (e.clientX - (btn.left + btn.width / 2));
      const dy = (e.clientY - (btn.top + btn.height / 2));
      const dist = Math.sqrt(dx*dx + dy*dy);
      if (dist < 120) moveNoButton();
    });

    noBtn.addEventListener("mouseenter", moveNoButton);
    noBtn.addEventListener("click", (e) => { e.preventDefault(); moveNoButton(); });

    yesBtn.addEventListener("click", () => {
      document.getElementById("loveText").innerHTML = LOVE_MESSAGE_HTML;
      showScreen("love");
    });

    /* ------------------ Love screen ------------------ */
    document.getElementById("replay").addEventListener("click", () => {
      coralIndex = 0;
      showScreen("start");
    });

    // Put No somewhere random on load for fun
    moveNoButton();
  </script>
</body>
</html>
