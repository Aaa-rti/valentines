<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Valentine's Reef Quest üíò</title>
  <style>
    /* --- Simple cute styling (EDIT ME if you want) --- */
    :root {
      --bg: #071a2b;
      --card: rgba(255,255,255,0.08);
      --text: #eaf6ff;
      --muted: rgba(234,246,255,0.75);
      --accent: #ff5aa5;
      --accent2: #4fe3c2;
      --danger: #ff6b6b;
      --shadow: 0 12px 40px rgba(0,0,0,0.35);
      --radius: 18px;
    }

    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color: var(--text);
      background:
        radial-gradient(1000px 600px at 20% 10%, rgba(79,227,194,0.16), transparent 60%),
        radial-gradient(900px 600px at 85% 20%, rgba(255,90,165,0.14), transparent 55%),
        radial-gradient(900px 700px at 40% 90%, rgba(100,149,237,0.18), transparent 60%),
        var(--bg);
      min-height: 100vh;
      display: grid;
      place-items: center;
      padding: 22px;
    }

    .wrap {
      width: min(920px, 100%);
    }

    .card {
      background: var(--card);
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
    }

    header {
      padding: 22px 22px 14px;
      border-bottom: 1px solid rgba(255,255,255,0.12);
    }

    h1 {
      margin: 0 0 6px 0;
      font-size: clamp(22px, 3vw, 32px);
      letter-spacing: 0.2px;
    }
    .subtitle { margin: 0; color: var(--muted); line-height: 1.35; }

    .content {
      padding: 22px;
      display: grid;
      gap: 16px;
    }

    .row { display: grid; gap: 14px; grid-template-columns: 1.25fr 1fr; }
    @media (max-width: 860px) { .row { grid-template-columns: 1fr; } }

    .panel {
      background: rgba(0,0,0,0.18);
      border: 1px solid rgba(255,255,255,0.10);
      border-radius: 14px;
      padding: 16px;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.06);
      color: var(--muted);
      font-size: 13px;
      margin-bottom: 10px;
    }

    .btns { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px; }
    button, .btn {
      appearance: none;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(255,255,255,0.10);
      color: var(--text);
      padding: 10px 14px;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.08s ease, background 0.2s ease, border 0.2s ease;
      user-select: none;
    }
    button:hover { transform: translateY(-1px); background: rgba(255,255,255,0.14); }
    button:active { transform: translateY(0px) scale(0.99); }

    .primary { border-color: rgba(255,90,165,0.55); background: rgba(255,90,165,0.20); }
    .primary:hover { background: rgba(255,90,165,0.28); }

    .good { border-color: rgba(79,227,194,0.55); background: rgba(79,227,194,0.18); }
    .good:hover { background: rgba(79,227,194,0.25); }

    .danger { border-color: rgba(255,107,107,0.55); background: rgba(255,107,107,0.18); }
    .danger:hover { background: rgba(255,107,107,0.25); }

    .hint { color: var(--muted); font-size: 14px; line-height: 1.35; }
    .status { font-weight: 700; margin-top: 10px; }
    .status.ok { color: var(--accent2); }
    .status.no { color: var(--danger); }

    img.coral {
      width: 100%;
      height: 320px;
      object-fit: cover;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(0,0,0,0.25);
    }
    @media (max-width: 860px) { img.coral { height: 260px; } }

    .codebox {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size: 13px;
      line-height: 1.45;
      background: rgba(0,0,0,0.35);
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 14px;
      padding: 12px;
      white-space: pre;
      overflow-x: auto;
    }

    input[type="text"] {
      width: 100%;
      box-sizing: border-box;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(0,0,0,0.25);
      color: var(--text);
      font-size: 14px;
      outline: none;
    }

    .screen { display: none; }
    .screen.active { display: block; }

    /* Valentine screen (moving No button) */
    .valentine-stage {
      position: relative;
      height: 340px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(0,0,0,0.20);
      overflow: hidden;
      padding: 14px;
    }
    .floating {
      position: absolute;
      left: 58%;
      top: 55%;
    }

    .photos {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 12px;
    }
    .photos img {
      width: 100%;
      height: 160px;
      object-fit: cover;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(0,0,0,0.25);
    }
    @media (max-width: 860px) {
      .photos { grid-template-columns: 1fr; }
      .photos img { height: 220px; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <header>
        <h1>For my coder, marine-biologist boyfriend‚Ä¶ üß†üåäüíò</h1>
        <p class="subtitle">
          <!-- EDIT ME: tweak this intro line -->
          You must complete the sacred reef tasks to unlock the final message.
          No pressure. The corals are watching.
        </p>
      </header>

      <div class="content">

        <!-- SCREEN 1: Coral ID quiz -->
        <section id="screen-quiz" class="screen active">
          <div class="row">
            <div class="panel">
              <div class="badge">ü™∏ Task 1 ¬∑ Coral ID</div>
              <div class="hint">
                <!-- EDIT ME: instructions -->
                Identify the coral. Your reputation (and my dramatic affection) depends on it.
              </div>

              <div style="margin-top:12px">
                <img id="coralImg" class="coral" src="" alt="Coral photo" />
              </div>

              <div id="choices" class="btns"></div>
              <div id="quizStatus" class="status"></div>

              <div class="btns" style="margin-top:14px">
                <button id="skipQuiz" class="danger" type="button">Skip (coward mode)</button>
              </div>
            </div>

            <div class="panel">
              <div class="badge">üß≠ How to customize</div>
              <div class="hint">
                Put coral images in an <b>images/</b> folder and update the <code>QUIZ</code> array in the script.
                You can include <i>Acropora loripes</i> as the correct answer for one of them (obviously).
              </div>
              <div class="hint" style="margin-top:10px">
                If you don‚Äôt have coral photos you own, use your own shots. (Avoid random Google images unless you
                have permission to reuse them.)
              </div>
            </div>
          </div>
        </section>

        <!-- SCREEN 2: R code task -->
        <section id="screen-code" class="screen">
          <div class="row">
            <div class="panel">
              <div class="badge">üíª Task 2 ¬∑ Finish the R code</div>
              <div class="hint">
                <!-- EDIT ME: instructions -->
                Fill in the missing line (the one with <b>???</b>). Keep it tidyverse-ish.
              </div>

              <div class="codebox" id="rSnippet"></div>

              <div style="margin-top:10px">
                <input id="codeInput" type="text" placeholder='Type the missing R line here, e.g. mutate(...)' />
              </div>

              <div class="btns">
                <button id="checkCode" class="good" type="button">Run the brain compiler</button>
                <button id="skipCode" class="danger" type="button">Skip (double coward mode)</button>
              </div>

              <div id="codeStatus" class="status"></div>
            </div>

            <div class="panel">
              <div class="badge">üîß Notes</div>
              <div class="hint">
                The check is simple string-matching (not a real R interpreter).
                You can make it easier/harder by changing the <code>CODE_EXPECTED</code> value in the script.
              </div>
            </div>
          </div>
        </section>

        <!-- SCREEN 3: Valentine question with moving No button -->
        <section id="screen-valentine" class="screen">
          <div class="panel">
            <div class="badge">üíñ Final Task ¬∑ The Big Question</div>
            <div class="hint">
              <!-- EDIT ME: question -->
              Will you be my Valentine?
            </div>

            <div class="valentine-stage" id="stage">
              <div style="max-width: 520px; margin-top: 10px;">
                <div class="hint">
                  <!-- EDIT ME: extra teasing text -->
                  Choose wisely. The ‚ÄúNo‚Äù option is‚Ä¶ ecologically unstable.
                </div>

                <div class="btns" style="margin-top:14px">
                  <button id="yesBtn" class="primary" type="button">YES üíò</button>
                </div>
              </div>

              <button id="noBtn" class="danger floating" type="button">No üôÉ</button>
            </div>
          </div>
        </section>

        <!-- SCREEN 4: Love message -->
        <section id="screen-love" class="screen">
          <div class="panel">
            <div class="badge">üå∫ Reef Unlocked ¬∑ Message</div>

            <div id="loveText" style="font-size: 18px; line-height: 1.5;">
              <!-- Filled by JS -->
            </div>

            <div class="photos">
              <!-- EDIT ME: add your own images (photos of you two, Fiji hype, etc.) -->
              <!-- Put files in images/ and update these src paths. You can delete extra <img> blocks. -->
              <img src="images/us1.jpg" alt="Us photo 1 (replace me)" />
              <img src="images/us2.jpg" alt="Us photo 2 (replace me)" />
              <img src="images/fiji.jpg" alt="Fiji photo (replace me)" />
            </div>

            <div class="btns" style="margin-top: 14px;">
              <button id="replay" class="good" type="button">Replay the chaos</button>
            </div>
          </div>
        </section>

      </div>
    </div>

    <p class="hint" style="text-align:center; margin-top: 14px;">
      Made with scientifically questionable romance and unusually persistent UI.
    </p>
  </div>

  <script>
    /* ============================================================
      EDIT ME SECTION 1: Coral quiz content
      - Put your images in /images/
      - Update src, correct, and options
    ============================================================ */
    const QUIZ = [
      {
        src: "images/coral1.jpg",               // EDIT ME: your image path
        correct: "Acropora loripes",            // EDIT ME
        options: ["Acropora loripes", "Pocillopora damicornis", "Montipora digitata", "Porites lobata"]
      },
      {
        src: "images/coral2.jpg",               // EDIT ME
        correct: "Pocillopora damicornis",      // EDIT ME
        options: ["Pocillopora damicornis", "Acropora tenuis", "Favia sp.", "Stylophora pistillata"]
      },
      {
        src: "images/coral3.jpg",               // EDIT ME
        correct: "Porites lobata",              // EDIT ME
        options: ["Porites lobata", "Acropora millepora", "Montipora capricornis", "Goniastrea sp."]
      }
    ];

    /* ============================================================
      EDIT ME SECTION 2: R code task content
      - Keep CODE_EXPECTED as the exact line you want them to type
      - The check is forgiving about whitespace + trailing semicolons
    ============================================================ */
    const R_SNIPPET = `
library(dplyr)

df <- tibble(
  species = c("acropora", "porites", "montipora"),
  cover   = c(0.42, 0.31, 0.27)
)

df %>%
  ??? %>%                             # <- fill this line
  arrange(desc(cover))
`.trim();

    // EDIT ME: what you expect them to type for the ??? line.
    // Example keeps it simple and pipey.
    const CODE_EXPECTED = 'mutate(is_fave = species == "acropora")';

    /* ============================================================
      EDIT ME SECTION 3: Love message text
    ============================================================ */
    const LOVE_MESSAGE_HTML = `
      <p><b>Heck yes.</b> ü•πüíò</p>
      <p>
        I‚Äôm so happy I get to do life with you ‚Äî the surfing, the coral nerd-outs,
        the RStudio wizardry, and the ‚Äúwait‚Ä¶ why is this object a list??‚Äù moments.
      </p>
      <p>
        Thanks for teaching me so much (especially pipes ‚Äî iconic). I love you a stupid amount,
        and I can‚Äôt wait to celebrate together in <b>Fiji</b> soon. üå¥üåä
      </p>
      <p>
        Now come collect your prize: a kiss, a cuddle, and possibly snacks.
      </p>
    `;

    /* ------------------ App state + helpers ------------------ */
    const screens = {
      quiz: document.getElementById("screen-quiz"),
      code: document.getElementById("screen-code"),
      val:  document.getElementById("screen-valentine"),
      love: document.getElementById("screen-love"),
    };

    function showScreen(key) {
      Object.values(screens).forEach(s => s.classList.remove("active"));
      screens[key].classList.add("active");
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    function shuffle(arr) {
      const a = [...arr];
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    function normalizeLine(s) {
      return s
        .trim()
        .replace(/;$/, "")
        .replace(/\s+/g, " ");
    }

    /* ------------------ Task 1: Coral quiz ------------------ */
    let quizIndex = 0;

    const coralImg = document.getElementById("coralImg");
    const choices = document.getElementById("choices");
    const quizStatus = document.getElementById("quizStatus");
    const skipQuiz = document.getElementById("skipQuiz");

    function renderQuiz() {
      quizStatus.textContent = "";
      quizStatus.className = "status";
      const q = QUIZ[quizIndex];

      coralImg.src = q.src;
      coralImg.onerror = () => {
        quizStatus.textContent =
          "Image not found üòÖ Put a file at that path (e.g. images/coral1.jpg), or update QUIZ.src in the code.";
        quizStatus.className = "status no";
      };

      choices.innerHTML = "";
      shuffle(q.options).forEach(opt => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.textContent = opt;
        btn.addEventListener("click", () => handleChoice(opt));
        choices.appendChild(btn);
      });
    }

    function handleChoice(opt) {
      const q = QUIZ[quizIndex];
      if (opt === q.correct) {
        quizStatus.textContent = "Correct ‚úÖ The reef approves.";
        quizStatus.className = "status ok";
        setTimeout(() => {
          quizIndex++;
          if (quizIndex >= QUIZ.length) showScreen("code");
          else renderQuiz();
        }, 750);
      } else {
        quizStatus.textContent = "Nope ‚ùå Try again (or blame lighting).";
        quizStatus.className = "status no";
      }
    }

    skipQuiz.addEventListener("click", () => showScreen("code"));

    /* ------------------ Task 2: R code check ------------------ */
    const rSnippet = document.getElementById("rSnippet");
    const codeInput = document.getElementById("codeInput");
    const checkCode = document.getElementById("checkCode");
    const skipCode = document.getElementById("skipCode");
    const codeStatus = document.getElementById("codeStatus");

    rSnippet.textContent = R_SNIPPET;

    checkCode.addEventListener("click", () => {
      const typed = normalizeLine(codeInput.value);
      const expected = normalizeLine(CODE_EXPECTED);

      if (!typed) {
        codeStatus.textContent = "Type something, oh mighty data plumber.";
        codeStatus.className = "status no";
        return;
      }

      if (typed === expected) {
        codeStatus.textContent = "Pass ‚úÖ Your tidyverse license remains valid.";
        codeStatus.className = "status ok";
        setTimeout(() => showScreen("val"), 650);
      } else {
        codeStatus.textContent = "Not quite ‚ùå (Hint: it starts with mutate(...))";
        codeStatus.className = "status no";
      }
    });

    skipCode.addEventListener("click", () => showScreen("val"));

    /* ------------------ Task 3: Moving No button ------------------ */
    const stage = document.getElementById("stage");
    const noBtn = document.getElementById("noBtn");
    const yesBtn = document.getElementById("yesBtn");

    function moveNoButton() {
      const stageRect = stage.getBoundingClientRect();
      const btnRect = noBtn.getBoundingClientRect();

      const padding = 12;
      const maxX = stageRect.width - btnRect.width - padding;
      const maxY = stageRect.height - btnRect.height - padding;

      const x = Math.max(padding, Math.floor(Math.random() * maxX));
      const y = Math.max(padding, Math.floor(Math.random() * maxY));

      noBtn.style.left = `${x}px`;
      noBtn.style.top = `${y}px`;
    }

    // Dodge when cursor gets close (desktop). Also works on touch (tap triggers move).
    stage.addEventListener("mousemove", (e) => {
      const btn = noBtn.getBoundingClientRect();
      const dx = (e.clientX - (btn.left + btn.width / 2));
      const dy = (e.clientY - (btn.top + btn.height / 2));
      const dist = Math.sqrt(dx*dx + dy*dy);

      if (dist < 120) moveNoButton();
    });

    noBtn.addEventListener("mouseenter", moveNoButton);
    noBtn.addEventListener("click", (e) => { e.preventDefault(); moveNoButton(); });

    yesBtn.addEventListener("click", () => {
      document.getElementById("loveText").innerHTML = LOVE_MESSAGE_HTML;
      showScreen("love");
    });

    /* ------------------ Love screen controls ------------------ */
    document.getElementById("replay").addEventListener("click", () => {
      // Reset state
      quizIndex = 0;
      codeInput.value = "";
      codeStatus.textContent = "";
      quizStatus.textContent = "";
      renderQuiz();
      showScreen("quiz");
    });

    /* ------------------ Boot ------------------ */
    renderQuiz();
    // Start the "No" button somewhere fun
    moveNoButton();
  </script>
</body>
</html>
